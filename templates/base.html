<!DOCTYPE html>
<html lang="{{ locale.language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ _('EduDuck') }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ _('EduDuck is a free AI-powered learning platform for students.') }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}{{ _('EduDuck - Free AI Study Tools') }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ _('Generate quizzes, flashcards from notes instantly. Free tier with Hugging Face, Google Gemini & premium OpenAI support.') }}{% endblock %}">
    <meta property="og:image" content="https://eduduck.app/static/img/duck.jpg">
    <meta property="og:url" content="https://eduduck.app">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{{ _('EduDuck - Free AI Study Tools') }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ _('Notes â†’ Quizzes & Flashcards instantly. Free AI for students.') }}{% endblock %}">
    <meta name="twitter:image" content="https://eduduck.app/static/img/duck.jpg">
    <meta name="keywords" content="{{ _('AI study tools, quiz generator, flashcard maker, free learning app, OCR notes, student AI, exam prep, homework help') }}">
    <meta name="robots" content="index, follow">
    <meta name="author" content="VxidDev">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">

    <link rel="stylesheet" href="/static/Main/style.css">

    <link rel="stylesheet" href="/static/theme-toggle.css">
    <link rel="stylesheet" href="/static/profile/style.css">

    <script src="/static/Components/csrf.js" defer></script>
    <script src="/static/Components/UserMenuPopUp.js" defer></script>
    <script src="{{ url_for('static' , filename='base.js') }}" type="module" defer></script>
    <script src="/dist/Components/background-anim.js"></script>
    <meta name="google-site-verification" content="AZ5cUHVKOHp9lKvThtsZ7HOlCFkWxvWi25c9ubsRV6Y"/>
    <meta name="msvalidate.01" content="2F2470319361A2FEDD539AEF5BF1803B" />
    {% block head %}{% endblock %}
</head>
<body>
    {% include 'includes/header.html' %}

    <!-- Theme toggle button with utility classes -->
    <button 
        id="theme-toggle" 
        class="fixed bottom-6 right-6 z-50 button button-icon button-lg rounded-full shadow-lg hover:shadow-xl transition-all"
        aria-label="{{ _('Toggle dark mode') }}"
        type="button">
        <span class="theme-icon text-xl">ðŸŒ™</span>
    </button>

    <!-- Main content area -->
    <main class="page-content-wrapper min-h-screen flex flex-col">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer with improved styling -->
    {% include 'includes/footer.html' %}

    <!-- Scripts -->
    <script src="/static/Components/DarkModeToggle.js"></script>

    <!-- Enhanced user menu dropdown behavior -->
    <script>
        // Improved dropdown behavior using CSS classes from our comprehensive system
        document.addEventListener('DOMContentLoaded', function() {
            const profileButton = document.getElementById('profile-button');
            const userMenu = document.getElementById('user-menu');
            const menuChevron = document.querySelector('.menu-chevron');

            if (profileButton && userMenu) {
                profileButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isOpen = userMenu.classList.contains('dropdown-open');

                    if (isOpen) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });

                // Close when clicking outside
                document.addEventListener('click', function(e) {
                    if (!userMenu.contains(e.target) && !profileButton.contains(e.target)) {
                        closeMenu();
                    }
                });

                // Close on escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && userMenu.classList.contains('dropdown-open')) {
                        closeMenu();
                        profileButton.focus();
                    }
                });

                function openMenu() {
                    userMenu.classList.add('dropdown-open');
                    userMenu.removeAttribute('hidden');
                    profileButton.setAttribute('aria-expanded', 'true');
                    if (menuChevron) menuChevron.style.transform = 'rotate(180deg)';
                }

                function closeMenu() {
                    userMenu.classList.remove('dropdown-open');
                    userMenu.setAttribute('hidden', '');
                    profileButton.setAttribute('aria-expanded', 'false');
                    if (menuChevron) menuChevron.style.transform = 'rotate(0deg)';
                }
            }
        });
    </script>
</body>
</html>
