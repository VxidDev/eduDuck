<!DOCTYPE html>
<html lang="{{ locale.language }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/variables.css">
    <title>{% block title %}{{ _('EduDuck') }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ _('EduDuck is a free AI-powered learning platform for students.') }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}{{ _('EduDuck - Free AI Study Tools') }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ _('Generate quizzes, flashcards from notes instantly. Free tier with Hugging Face, Google Gemini & premium OpenAI support.') }}{% endblock %}">
    <meta property="og:image" content="https://eduduck.app/static/img/duck.jpg">
    <meta property="og:url" content="https://eduduck.app">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{{ _('EduDuck - Free AI Study Tools') }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ _('Notes â†’ Quizzes & Flashcards instantly. Free AI for students.') }}{% endblock %}">
    <meta name="twitter:image" content="https://eduduck.app/static/img/duck.jpg">
    <meta name="keywords" content="{{ _('AI study tools, quiz generator, flashcard maker, free learning app, OCR notes, student AI, exam prep, homework help') }}">
    <meta name="robots" content="index, follow">
    <meta name="author" content="VxidDev">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">

    <link rel="stylesheet" href="/static/Main/style.css">

    <link rel="stylesheet" href="/static/theme-toggle.css">
    <link rel="stylesheet" href="/static/Main/style.css">
    <link rel="stylesheet" href="/static/profile/style.css">
    <link rel="stylesheet" href="/disable_css_anim.css">

    <script src="/static/Components/csrf.js" defer></script>
    <script src="/static/Components/UserMenuPopUp.js" defer></script>
    <script src="{{ url_for('static' , filename='base.js') }}" type="module" defer></script>
    <script src="/dist/Components/background-anim.js"></script>
    <meta name="google-site-verification" content="AZ5cUHVKOHp9lKvThtsZ7HOlCFkWxvWi25c9ubsRV6Y"/>
    <meta name="msvalidate.01" content="2F2470319361A2FEDD539AEF5BF1803B" />
    {% block head %}{% endblock %}
</head>
<body>
    <header class="header fixed top-0 left-0 right-0 z-fixed border-b border-primary shadow-sm">
        <nav class="header-nav container mx-auto flex items-center justify-between py-4" aria-label="{{ _('Main navigation') }}">
            <a class="header-redirect button button-ghost button-sm inline-flex items-center gap-2 transition-all" 
               href="https://ko-fi.com/vxiddev" 
               aria-label="Support on Ko-fi">
                <svg class="donate-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="currentColor"/>
                </svg>
                <span>{{ _('Donate') }}</span>
            </a>

            <div class="header-brand">
                <h1 class="header-text text-2xl font-bold m-0">
                    <a href="/" class="inline-flex items-center gap-2 text-primary hover:text-primary transition-colors">
                        <span class="brand-icon text-3xl" aria-hidden="true">ðŸ¦†</span>
                        <span>{{ _('EduDuck') }}</span>
                    </a>
                </h1>
            </div>

            <div class="header-actions flex items-center gap-4">
                <form id="language-selector-form" action="{{ url_for('set_language') }}" method="post" style="width: 150px;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <select id="language" class="select" name="lang" onchange="this.form.submit()">
                        <option value="en" {% if locale.language == 'en' %}selected{% endif %}>{{ _('English') }}</option>
                        <option value="pl" {% if locale.language == 'pl' %}selected{% endif %}>{{ _('Polish') }}</option>
                        <option value="uk" {% if locale.language == 'uk' %}selected{% endif %}>{{ _('Ukrainian') }}</option>
                        <option value="fr" {% if locale.language == 'fr' %}selected{% endif %}>{{ _('French') }}</option>
                        <option value="ru" {% if locale.language == 'ru' %}selected{% endif %}>{{ _('Russian') }}</option>
                        <option value="de" {% if locale.language == 'de' %}selected{% endif %}>{{ _('German') }}</option>
                    </select>
                </form>
                {% if not current_user.is_authenticated %}
                    <div class="auth-links flex items-center gap-3">
                        <a class="header-link header-link-primary button button-ghost button-sm" href="/login">{{ _('Login') }}</a>
                        <span class="divider text-tertiary" aria-hidden="true">â€¢</span>
                        <a class="header-link header-link-primary button button-primary button-sm" href="/register">{{ _('Register') }}</a>
                    </div>
                    <span class="free-uses badge badge-neutral text-xs" role="status">
                        <svg class="inline-block mr-1" width="14" height="14" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        {{ _('3 free uses/day') }}
                    </span>
                {% else %}
                    <!-- User menu for logged in users -->
                    <div class="user-menu-wrapper relative">
                        <button 
                            class="user-menu-toggle button button-ghost button-sm inline-flex items-center gap-2 px-2" 
                            id="profile-button"
                            type="button"
                            aria-haspopup="menu"
                            aria-expanded="false"
                            aria-label="{{ _('User menu') }}"
                            aria-controls="user-menu">
                            <img 
                                id="user-pfp" 
                                src="/profile/user-pfp/{{ current_user.id }}"
                                alt="{{ _('Profile picture') }}" 
                                class="user-avatar pfp w-8 h-8 rounded-full border border-primary">
                            <span class="menu-chevron text-xs transition-transform" aria-hidden="true">â–¼</span>
                        </button>

                        <!-- Dropdown menu -->
                        <div 
                            class="user-menu dropdown-menu absolute right-0 mt-2 w-64 bg-card border border-primary rounded-lg shadow-xl opacity-0 pointer-events-none transition-all"
                            id="user-menu" 
                            role="menu"
                            aria-labelledby="profile-button"
                            hidden>
                            <!-- Menu header with usage badge -->
                            <div class="menu-header px-4 py-3 border-b border-primary">
                                <span id="FreeUsageText" class="usage-badge badge badge-primary inline-flex items-center gap-2 text-sm" role="status">
                                    <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    {{ remaining }} {{ _('uses left today') }}
                                </span>
                            </div>

                            <!-- Menu items -->
                            <a href="/profile" class="dropdown-item flex items-center gap-3 px-4 py-3 text-primary hover:bg-secondary transition-colors" role="menuitem">
                                <svg class="menu-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                {{ _('Profile') }}
                            </a>
                            <a href="/settings" class="dropdown-item flex items-center gap-3 px-4 py-3 text-primary hover:bg-secondary transition-colors" role="menuitem">
                                <svg class="menu-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 1v6m0 6v6M23 12h-6m-6 0H1" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                {{ _('Settings') }}
                            </a>

                            <hr class="menu-divider dropdown-divider my-2" role="separator">

                            <a href="/logout" class="dropdown-item danger flex items-center gap-3 px-4 py-3 text-error hover:bg-error-soft transition-colors" role="menuitem">
                                <svg class="menu-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                {{ _('Log out') }}
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </nav>
    </header>

    <!-- Theme toggle button with utility classes -->
    <button 
        id="theme-toggle" 
        class="fixed bottom-6 right-6 z-50 button button-icon button-lg rounded-full shadow-lg hover:shadow-xl transition-all"
        aria-label="{{ _('Toggle dark mode') }}"
        type="button">
        <span class="theme-icon text-xl">ðŸŒ™</span>
    </button>

    <!-- Main content area -->
    <main class="page-content-wrapper min-h-screen flex flex-col">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer with improved styling -->
    <footer class="bg-secondary border-t border-primary py-12 px-6 mt-auto">
        <div class="container mx-auto text-center">
            <p class="text-secondary text-sm mb-0">
                {{ _('By') }} <a class="repoLink link-primary font-medium" href="https://github.com/VxidDev/eduDuck/">VxidDev</a> - 2026
                <span class="text-tertiary mx-2" aria-hidden="true">|</span>
                {{ _('Open Source on GitHub') }}
                <span class="text-tertiary mx-2" aria-hidden="true">|</span>
                <a class="repoLink link-primary font-medium" href="/terms">{{ _('Terms of Service') }}</a>
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/static/Components/DarkModeToggle.js"></script>

    <!-- Enhanced user menu dropdown behavior -->
    <script>
        // Improved dropdown behavior using CSS classes from our comprehensive system
        document.addEventListener('DOMContentLoaded', function() {
            const profileButton = document.getElementById('profile-button');
            const userMenu = document.getElementById('user-menu');
            const menuChevron = document.querySelector('.menu-chevron');

            if (profileButton && userMenu) {
                profileButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isOpen = userMenu.classList.contains('dropdown-open');

                    if (isOpen) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                });

                // Close when clicking outside
                document.addEventListener('click', function(e) {
                    if (!userMenu.contains(e.target) && !profileButton.contains(e.target)) {
                        closeMenu();
                    }
                });

                // Close on escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && userMenu.classList.contains('dropdown-open')) {
                        closeMenu();
                        profileButton.focus();
                    }
                });

                function openMenu() {
                    userMenu.classList.add('dropdown-open');
                    userMenu.removeAttribute('hidden');
                    profileButton.setAttribute('aria-expanded', 'true');
                    if (menuChevron) menuChevron.style.transform = 'rotate(180deg)';
                }

                function closeMenu() {
                    userMenu.classList.remove('dropdown-open');
                    userMenu.setAttribute('hidden', '');
                    profileButton.setAttribute('aria-expanded', 'false');
                    if (menuChevron) menuChevron.style.transform = 'rotate(0deg)';
                }
            }
        });
    </script>
</body>
</html>