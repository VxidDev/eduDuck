<header class="header">
    <nav class="header-nav" aria-label="{{ _('Main navigation') }}">
        <a class="header-redirect"
           href="https://ko-fi.com/vxiddev"
           aria-label="Support on Ko-fi">
            <svg class="donate-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="currentColor"/>
            </svg>
            <span>{{ _('Donate') }}</span>
        </a>

        <div class="header-brand">
            <h1 class="header-text">
                <a href="/">
                    <span class="brand-icon" aria-hidden="true">ðŸ¦†</span>
                    <span style="align-self: center;">{{ _('EduDuck') }}</span>
                </a>
            </h1>
        </div>

        <div class="header-actions">
            <form id="language-selector-form" action="{{ url_for('set_language') }}" method="post" style="width: 150px;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <select id="language" class="select" name="lang" onchange="this.form.submit()">
                    <option value="en" {% if locale.language == 'en' %}selected{% endif %}>{{ _('English') }}</option>
                    <option value="pl" {% if locale.language == 'pl' %}selected{% endif %}>{{ _('Polish') }}</option>
                    <option value="uk" {% if locale.language == 'uk' %}selected{% endif %}>{{ _('Ukrainian') }}</option>
                    <option value="fr" {% if locale.language == 'fr' %}selected{% endif %}>{{ _('French') }}</option>
                    <option value="ru" {% if locale.language == 'ru' %}selected{% endif %}>{{ _('Russian') }}</option>
                    <option value="de" {% if locale.language == 'de' %}selected{% endif %}>{{ _('German') }}</option>
                </select>
            </form>
            {% if not current_user.is_authenticated %}
                <div class="auth-links">
                    <a class="header-link header-link-primary button" href="/login">{{ _('Login') }}</a>
                    <span class="divider" aria-hidden="true">â€¢</span>
                    <a class="header-link header-link-primary button" href="/register">{{ _('Register') }}</a>
                </div>
                <span class="free-uses" role="status">
                    <svg class="inline-block mr-1" width="14" height="14" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    {{ _('3 free uses/day') }}
                </span>
            {% else %}
                <!-- User menu for logged in users -->
                <div class="user-menu-wrapper relative">
                    <button
                        class="user-menu-toggle"
                        id="profile-button"
                        type="button"
                        aria-haspopup="menu"
                        aria-expanded="false"
                        aria-label="{{ _('User menu') }}"
                        aria-controls="user-menu">
                        <img
                            id="user-pfp"
                            alt="{{ _('Profile picture') }}"
                            class="user-avatar pfp">
                        <span class="menu-chevron" aria-hidden="true">â–¼</span>
                    </button>

                    <!-- Dropdown menu -->
                    <div
                        <div class="user-menu"
                        id="user-menu"
                        role="menu"
                        aria-labelledby="profile-button"
                        hidden>
                        <!-- Menu header with usage badge -->
                        <div class="menu-header">
                            <span id="FreeUsageText" class="usage-badge" role="status">
                                <svg class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                {{ remaining }} {{ _('uses left today') }}
                            </span>
                        </div>

                        <!-- Menu items -->
                        <a href="/profile" class="dropdown-item" role="menuitem">
                            <svg class="menu-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {{ _('Profile') }}
                        </a>
                        <a href="/settings" class="dropdown-item" role="menuitem">
                            <svg class="menu-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                <path d="M12 1v6m0 6v6M23 12h-6m-6 0H1" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            {{ _('Settings') }}
                        </a>

                        <hr class="menu-divider dropdown-divider" role="separator">

                        <a href="/logout" class="dropdown-item danger" role="menuitem">
                            <svg class="menu-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            {{ _('Log out') }}
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </nav>
</header>